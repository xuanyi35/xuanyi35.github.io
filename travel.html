<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" type="text/css" href="css/style.css">
            <script src="script/script.js" type="text/javascript"></script>
    </head>
    <body>
        
        
        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav();">&times;</a>
            <a href="#">About</a>
            <a href="#">Services</a>
            <a href="#">Clients</a>
            <a href="#">Contact</a>
        </div>
        <div id="main">
            <div style="position:fixed; width:100vw; background-image: url('img/wallpaper.jpg');">
                <span style="font-size:25px;cursor:pointer; margin-left:2%; " onclick="openNav();">&#9776; Xuanyi's Blog </span>
            </div>
            <br>
            <div class="fixed-bg" style="margin-top:25px; ">
                <div class="transbox">
                    <!--p>  Upload  Cite from  https://www.codeproject.com/Articles/1245928/JavaScript-Image-Upload-for-Async-Server-Processin  </p-->
                    <img src="//:0" id="preview" style="width:30%"/>
                    <input type="file" id="imageFileInput" accept=".jpg, .jpeg, .png" />
                    <script>
                        document.getElementById('imageFileInput').addEventListener('change', function() {
                                                                                   
                   var img = this.files[0];
                   // Image is accessible using JavaScript
                   uploadImage(img, '/image/upload', function(response) {
                               // Image upload to server response
                               // Show the image using setImageUrl(URL)
                               })
                   getBase64ImageUrl(img, function(getBase64ImageUrl) {
                                     setImageUrl(getBase64ImageUrl);
                                     });
                   }, false);
                   
                   function setImageUrl(url) {
                       document.getElementById('preview').setAttribute('src', url);
                   };
                    
                    function getBase64ImageUrl(img, callback) {
                        var reader = new FileReader();
                        reader.readAsDataURL(img);
                        reader.onload = function() {
                            callback && callback(reader.result);
                        };
                        reader.onerror = function(error) {
                            console.log('Error: ', error);
                        };
                    };
                    
                    function uploadImage(img, url, callback) {
                        var xhr = new XMLHttpRequest();
                        var fd = new FormData();
                        xhr.open("POST", url, true);
                        xhr.onreadystatechange = function() {
                            if (xhr.readyState == 4 && xhr.status == 200) {
                                callback && callback(xhr.responseText);
                            }
                        };
                        fd.append("upload_image", img);
                        xhr.send(fd);
                    };
                    </script>
                </div>
            </div>
        </div>
        
    </body>
    
</html>
